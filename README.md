# sRRNet

Implemented a lightweight coarse-to-fine stereo matching framework optimized for embedded GPUs, 
enabling efficient and accurate depth estimation under constrained computational resources.

### input 
(‚ö†Ô∏è The original small size of disparity maps are generated by [z2zncc](https://github.com/changqiong/z2zncc))

<img src="result/sample_small.png" alt=" Image" width="35%">

### output
<img src="result/sample_large.png" alt=" Image" width="70%">

## üì¶ Requirements

Install the following packages before running the code:

```bash
pip install tensorflow-GPU==1.9.0
pip install opencv-python
pip install numpy
any other requirements
```
‚ö†Ô∏è This project was completed in September 2020, and therefore relies on older versions of some function libraries.


Also, make sure you have:

- Python 2.7+
- GPU-enabled environment (e.g. Jetson Tx2/AGX) with CUDA/cuDNN support

## Directory Structure

```
sRRNet/
‚îú‚îÄ‚îÄ config/              # JSON configuration files for training/testing
‚îÇ   ‚îú‚îÄ‚îÄ training.json
‚îÇ   ‚îî‚îÄ‚îÄ testing.json
‚îú‚îÄ‚îÄ data/                # Image data for training/testing
‚îÇ   ‚îú‚îÄ‚îÄ train
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ disp         # Quarter size of initial disparity
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gt_noc
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mini_left    # Original size of left image 
‚îÇ   ‚îî‚îÄ‚îÄ test
‚îÇ       ‚îú‚îÄ‚îÄ disp         # Quarter size of initial disparity
‚îÇ       ‚îú‚îÄ‚îÄ mini_left    # Quarter size of left image
‚îÇ       ‚îî‚îÄ‚îÄ test_left    # Original size of left image 
‚îú‚îÄ‚îÄ model/               # Folder to save or load trained models
‚îú‚îÄ‚îÄ result/              # Folder to save output images during testing
‚îú‚îÄ‚îÄ main.py              # Main training/testing script
‚îú‚îÄ‚îÄ tfmodel.py     	 # Model architecture
‚îú‚îÄ‚îÄ data_loader.py       # Custom dataloader
‚îú‚îÄ‚îÄ utils.py             # Utility functions (if any)
‚îî‚îÄ‚îÄ README.md            # This file
```

## üöÄ Run

### Training

To start training, run:

```bash
python main.py --config ./config/training.json
```

This will train the model and save checkpoints in `./model/`.

### Testing

To test a model, run:

```bash
python main.py --config ./config/testing.json --model ./model/{model.name} --mode test
```

Replace `{model.name}` with your actual model file, e.g., `model-90000.meta`.

A pre-trained model 'model.ckpt-pretrain' is provided in './model/' folder. 

### Output

- Prediction results are saved in the `result/` folder.
- Logs and intermediate results are printed to console.



## Related Publications

> Chang, Qiong, et al. 
> "TinyStereo: A Tiny Coarse-to-Fine Framework for Vision-Based Depth Estimation on Embedded GPUs."
> IEEE Transactions on Systems, Man, and Cybernetics: Systems (2024).

and

> Chang, Qiong, et al. 
> "StereoVAE: A lightweight stereo-matching system using embedded GPUs"
> IEEE International Conference on Robotics and Automation (ICRA), 2023
---

## What to Cite

If you use this code for academic purposes, please cite the following paper:

```bibtex
@article{chang2024tinystereo,
  title={TinyStereo: A Tiny Coarse-to-Fine Framework for Vision-Based Depth Estimation on Embedded GPUs},
  author={Chang, Qiong and Xu, Xin and Zha, Aolong and Er, Meng Joo and Sun, Yongqing and Li, Yun},
  journal={IEEE Transactions on Systems, Man, and Cybernetics: Systems},
  year={2024},
  publisher={IEEE}
}

and

@inproceedings{chang2023stereovae,
  title={StereoVAE: A lightweight stereo-matching system using embedded GPUs},
  author={Chang, Qiong and Li, Xiang and Xu, Xin and Liu, Xin and Li, Yun and Miyazaki, Jun},
  booktitle={2023 IEEE International Conference on Robotics and Automation (ICRA)},
  pages={1982--1988},
  year={2023},
  organization={IEEE}
}
```

---

## üí° Notes

- Code uses `tf.ConfigProto` with `allow_growth=True` to prevent full GPU memory allocation.
- The dataset must be preprocessed (e.g. by [z2zncc](https://github.com/changqiong/z2zncc)) in advance and stored in the paths specified in the config file.
- The model is optimized for small-scale stereo refinement; you may adapt it for larger datasets or integrate it into existing stereo pipelines.


## License

This project is released under the [MIT License](LICENSE).

---